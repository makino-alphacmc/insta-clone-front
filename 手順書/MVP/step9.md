# Step 9: リリース前チェック

## 📋 このステップでやること

リリース前に、アプリケーションが正しく動作するか、すべての機能を確認します。

## ✅ チェックリスト

### 9-1) 機能テスト
※ 目的: 実装した全機能の動作を確認し、リリース前の欠陥を洗い出す。

#### フロントエンド
※ 因果: 画面側の不具合はUX低下に直結するため、先にUI動作を網羅。
- [ ] タイムライン画面が正しく表示される
- [ ] 投稿がない場合の空状態が表示される
- [ ] ローディング状態（Skeleton）が表示される
- [ ] エラー状態が適切に表示される
- [ ] 新規投稿画面で画像を選択できる
- [ ] 画像プレビューが表示される
- [ ] キャプションを入力できる
- [ ] 投稿ボタンで投稿できる
- [ ] 投稿成功時にトーストが表示される
- [ ] 投稿後にタイムラインに戻る
- [ ] 新しい投稿がタイムラインに表示される

#### バックエンドAPI
※ 因果: APIが正しく動かなければフロントも機能しないため、データフローを検証。
- [ ] `GET /health` が動作する
- [ ] `GET /posts` で投稿一覧が取得できる
- [ ] `POST /posts` で画像とキャプションを投稿できる
- [ ] 画像が Supabase Storage にアップロードされる
- [ ] データベースに投稿が保存される
- [ ] エラーハンドリングが適切に動作する

### 9-2) UI/UX テスト
※ 目的: 画面崩れや可読性を確認し、本番での利用体験を担保する。

- [ ] スマートフォン幅（375px）でレイアウトが崩れない
- [ ] タブレット幅（768px）でレイアウトが適切
- [ ] デスクトップ幅（1920px）でレイアウトが適切
- [ ] 画像が適切なサイズで表示される
- [ ] ボタンがクリックしやすいサイズ
- [ ] フォントサイズが読みやすい
- [ ] カラーコントラストが適切

### 9-3) エラーハンドリング
※ 目的: 想定外入力・通信失敗時の挙動を確認し、ユーザーに正しいフィードバックを返す。

- [ ] 画像を選択せずに投稿しようとした場合のエラー
- [ ] 画像サイズが大きすぎる場合のエラー（10MB以上など）
- [ ] ネットワークエラー時の表示
- [ ] APIエラー時の表示
- [ ] バリデーションメッセージが適切

### 9-4) パフォーマンス
※ 目的: レイテンシや読み込み時間が許容内かを確認し、離脱を防ぐ。

- [ ] ページの読み込みが速い（3秒以内）
- [ ] 画像の読み込みが適切
- [ ] APIレスポンスが速い（1秒以内）
- [ ] メモリリークがない（長時間使用しても問題ない）

### 9-5) データ永続化
※ 目的: 再起動や障害後もデータが残ることを確認し、運用リスクを下げる。

- [ ] SQLite データベースが永続化されている
- [ ] Docker コンテナを再起動してもデータが残る
- [ ] ボリュームマウントが正しく設定されている

### 9-6) セキュリティ
※ 目的: 秘匿情報やCORS設定などを再確認し、漏洩や脆弱性を防ぐ。

- [ ] `.env` ファイルがGitにコミットされていない
- [ ] CORS設定が適切（本番URLのみ許可）
- [ ] Supabase のキーが適切に管理されている
- [ ] 画像ファイルのバリデーション（拡張子チェックなど）

### 9-7) ドキュメント
※ 目的: 起動手順と設定を明文化し、チーム内外で再現性を高める。

- [ ] README.md に起動手順が書かれている
- [ ] 環境変数の説明が書かれている
- [ ] デプロイ手順が書かれている
- [ ] トラブルシューティング情報が書かれている

## 📝 テスト手順

### ローカル環境でのテスト
※ 因果: 手元で再現できる形にすることで、本番前のデバッグコストを下げる。

```bash
# 1. バックエンドを起動
cd ~/work/insta-clone-api
source venv/bin/activate
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 2. フロントエンドを起動（別ターミナル）
cd ~/work/insta-clone-front
npm run dev

# 3. ブラウザで動作確認
# - http://localhost:3000 を開く
# - すべての機能をテスト
```

### Docker環境でのテスト
※ 因果: 本番に近いコンテナ環境で再度検証し、差分による不具合を防ぐ。

```bash
# 1. コンテナを起動
cd ~/work
docker compose up -d --build

# 2. ログを確認
docker compose logs -f

# 3. ブラウザで動作確認
# - http://localhost:3000 を開く
# - http://localhost:8000/health を開く
# - すべての機能をテスト
```

## 🐛 よくある問題と解決方法
※ 目的: 典型的な失敗パターンを事前に示し、トラブル時の因果を素早く特定できるようにする。

### 問題1: CORS エラー

**症状**: ブラウザのコンソールにCORSエラーが表示される

**解決方法**:
- `insta-clone-api/.env` の `ALLOWED_ORIGINS` を確認
- フロントエンドのURLが含まれているか確認

### 問題2: 画像が表示されない

**症状**: 投稿は成功するが、画像が表示されない

**解決方法**:
- Supabase Storage の bucket が Public になっているか確認
- 画像URLが正しく返されているか確認（ブラウザの開発者ツールで確認）

### 問題3: データベースがリセットされる

**症状**: コンテナを再起動するとデータが消える

**解決方法**:
- `docker-compose.yml` の volumes 設定を確認
- データベースファイルが正しくマウントされているか確認

## ✅ 最終チェックリスト

- [ ] すべての機能が動作する
- [ ] エラーハンドリングが適切
- [ ] UI/UX が問題ない
- [ ] パフォーマンスが問題ない
- [ ] セキュリティが適切
- [ ] ドキュメントが整備されている
- [ ] 本番環境で動作確認が完了している

## 🎯 次のステップ

すべてのチェックが完了したら、**step10.md** に進んでください。
（リリース）

